{% extends 'index.html' %}

{% block content %}
    <h2 id="sale">SALE</h2>
    <h7> 💥 Aquí podrás ver todas las promociones que se encuentran en nuestro Showroom 💥</h7>
       

{% for modelo in modelos %}
  <section class="categoria" id="modelo-{{ loop.index }}">
    <div class="modelo-fotos">
      {% for producto in modelo.productos %}
        <div class="producto">
          <img src="{{ url_for('static', filename=producto.imagen) }}" alt="{{ producto.nombre }}">
          <p>{{ producto.nombre }}</p>
          <p>{{ producto.precio }}</p>
          
          <button onclick="agregarAlCarrito('{{ producto.nombre }}', '{{ producto.precio }}' )">Agregar al carrito
          </button>
        </div>
      {% endfor %}
    </div>
  </div>
</section>


{% endfor %}

<div id="modal-imagen" class="modal">
  <span class="cerrar">&times;</span>
  <img class="modal-contenido" id="imagen-grande">
</div>

<script>
  // Obtiene elementos
  const modal = document.getElementById("modal-imagen");
  const imgGrande = document.getElementById("imagen-grande");
  const cerrar = document.querySelector(".cerrar");

  // Para todas las imágenes de modelo
  document.querySelectorAll(".modelo-fotos img").forEach(img => {
    img.addEventListener("click", () => {
      modal.style.display = "flex";
      imgGrande.src = img.src;
    });
  });

  // Cierra al hacer clic en la cruz
  cerrar.addEventListener("click", () => {
    modal.style.display = "none";
  });

  // También cierra al hacer clic fuera de la imagen
  modal.addEventListener("click", (e) => {
    if (e.target === modal) {
      modal.style.display = "none";
    }
  });
</script>




<script>
  let carrito = [];

  // Cargar el carrito desde localStorage al abrir la página
  window.onload = function() {
    const guardado = localStorage.getItem("carrito");
    if (guardado) {
      carrito = JSON.parse(guardado);
      mostrarCarrito();
    }
  };

  function guardarCarrito() {
    localStorage.setItem("carrito", JSON.stringify(carrito));
  }

  function agregarAlCarrito(nombre, precio){
    
    carrito.push({ nombre, precio});
    guardarCarrito();
    mostrarCarrito();
  }

  function mostrarCarrito() {
    const lista = document.getElementById("lista-carrito");
    if (!lista) return; // por si una página no tiene carrito visible
    lista.innerHTML = "";

    carrito.forEach((item, index) => {
      const li = document.createElement("li");
      li.textContent = `${item.nombre} - ${item.precio}`;

      const btnEliminar = document.createElement("button");
      btnEliminar.textContent = "❌";
      btnEliminar.style.border = "none";
      btnEliminar.style.background = "transparent";
      btnEliminar.style.cursor = "pointer";
      btnEliminar.onclick = () => eliminarDelCarrito(index);

      li.appendChild(btnEliminar);
      lista.appendChild(li);
    });
  }

  function eliminarDelCarrito(index) {
    carrito.splice(index, 1);
    guardarCarrito();
    mostrarCarrito();
  }

  function realizarCompra() {
    if (carrito.length === 0) {
      alert("Tu carrito está vacío 😅");
      return;
    }

    let mensaje = "Hola! Quisiera comprar los siguientes productos:%0A%0A";
    carrito.forEach((item, i) => {
      mensaje += `${1}. ${item.nombre} - ${item.precio}%0A .`;
    });

    const telefono = "5491122334455"; // Cambiá por el número del vendedor
    const url = `https://wa.me/${telefono}?text=${mensaje}`;
    window.open(url, "_blank");
  }
</script>
{% endblock %}
