{% extends 'index.html' %}

{% block content %}
    <h2 id="sale">SALE</h2>
    <h7> üí• Aqu√≠ podr√°s ver todas las promociones que se encuentran en nuestro Showroom üí•</h7>
       

{% for modelo in modelos %}
  <section class="categoria" id="modelo-{{ loop.index }}">
    <div class="modelo-fotos">
      {% for producto in modelo.productos %}
        <div class="producto">
          <img src="{{ url_for('static', filename=producto.imagen) }}" alt="{{ producto.nombre }}">
          <p>{{ producto.nombre }}</p>
          <p>{{ producto.precio }}</p>
          <div class="seleccion-talle">
             <p>Seleccion√° tu talle:</p>
             <input type="radio" id="talle38_{{ loop.index }}" name="talle_{{ loop.index }}" value="38">
              <label for="talle38_{{ loop.index }}">38</label>

             <input type="radio" id="talle40_{{ loop.index }}" name="talle_{{ loop.index }}" value="40">
             <label for="talle40_{{ loop.index }}">40</label>

             <input type="radio" id="talle42_{{ loop.index }}" name="talle_{{ loop.index }}" value="42">
             <label for="talle42_{{ loop.index }}">42</label>
           </div>

          <button onclick="agregarAlCarrito('{{ producto.nombre }}', '{{ producto.precio }}','talle_{{ loop.index }}' )">Agregar al carrito
          </button>
        </div>
      {% endfor %}
    </div>
  </div>
</section>


{% endfor %}

<div id="modal-imagen" class="modal">
  <span class="cerrar">&times;</span>
  <img class="modal-contenido" id="imagen-grande">
</div>

<script>
  // Obtiene elementos
  const modal = document.getElementById("modal-imagen");
  const imgGrande = document.getElementById("imagen-grande");
  const cerrar = document.querySelector(".cerrar");

  // Para todas las im√°genes de modelo
  document.querySelectorAll(".modelo-fotos img").forEach(img => {
    img.addEventListener("click", () => {
      modal.style.display = "flex";
      imgGrande.src = img.src;
    });
  });

  // Cierra al hacer clic en la cruz
  cerrar.addEventListener("click", () => {
    modal.style.display = "none";
  });

  // Tambi√©n cierra al hacer clic fuera de la imagen
  modal.addEventListener("click", (e) => {
    if (e.target === modal) {
      modal.style.display = "none";
    }
  });
</script>




<script>
  let carrito = [];

  // Cargar el carrito desde localStorage al abrir la p√°gina
  window.onload = function() {
    const guardado = localStorage.getItem("carrito");
    if (guardado) {
      carrito = JSON.parse(guardado);
      mostrarCarrito();
    }
  };

  function guardarCarrito() {
    localStorage.setItem("carrito", JSON.stringify(carrito));
  }

  function agregarAlCarrito(nombre, precio, grupoTalle){
    const talleSeleccionado = document.querySelector(`input[name="${grupoTalle}"]:checked`);
  
    if (!talleSeleccionado) {
      alert("Por favor seleccion√° un talle üòÖ");
      return;
    }
    
    carrito.push({ nombre, precio,talle: talleSeleccionado.value  });
    guardarCarrito();
    mostrarCarrito();
  }

  function mostrarCarrito() {
    const lista = document.getElementById("lista-carrito");
    if (!lista) return; // por si una p√°gina no tiene carrito visible
    lista.innerHTML = "";

    carrito.forEach((item, index) => {
      const li = document.createElement("li");
      li.textContent = `${item.nombre} - ${item.precio} - Talle: ${item.talle}`;

      const btnEliminar = document.createElement("button");
      btnEliminar.textContent = "‚ùå";
      btnEliminar.style.border = "none";
      btnEliminar.style.background = "transparent";
      btnEliminar.style.cursor = "pointer";
      btnEliminar.onclick = () => eliminarDelCarrito(index);

      li.appendChild(btnEliminar);
      lista.appendChild(li);
    });
  }

  function eliminarDelCarrito(index) {
    carrito.splice(index, 1);
    guardarCarrito();
    mostrarCarrito();
  }

  function realizarCompra() {
    if (carrito.length === 0) {
      alert("Tu carrito est√° vac√≠o üòÖ");
      return;
    }

    let mensaje = "Hola! Quisiera comprar los siguientes productos:%0A%0A";
    carrito.forEach((item, i) => {
      mensaje += `${1}. ${item.nombre} - ${item.precio}%0A - ${item.talle} .`;
    });

    const telefono = "5491122334455"; // Cambi√° por el n√∫mero del vendedor
    const url = `https://wa.me/${telefono}?text=${mensaje}`;
    window.open(url, "_blank");
  }
</script>
{% endblock %}
