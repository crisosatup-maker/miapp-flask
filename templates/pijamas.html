{% extends 'index.html' %}

{% block content %}
  <h2>Pijamas</h2>


<div class="mini-menu-flotante">
  <h6>Modelos de Pijamas: <h6>
  <ul>
    {% for modelo in modelos %}
      <li><a href="#modelo-{{ loop.index }}">{{ modelo.nombretitulo }}</a></li>
    {% endfor %}
  </ul>
</div>

{% for modelo in modelos %}
  <section class="categoria" id="modelo-{{ loop.index }}">
    <div class="modelo-fotos">
      {% for producto in modelo.productos %}
        <div class="producto">
          <img src="{{ url_for('static', filename=producto.imagen) }}" alt="{{ producto.nombre }}">
          <p>{{ producto.nombre }}</p>
          <p>{{ producto.precio }}</p>
          <div class="seleccion-talle">
             <p>Seleccion√° tu talle:</p>
             <input type="radio" id="talle38_{{ loop.index }}" name="talle_{{ loop.index }}" value="38">
              <label for="talle38_{{ loop.index }}">38</label>

             <input type="radio" id="talle40_{{ loop.index }}" name="talle_{{ loop.index }}" value="40">
             <label for="talle40_{{ loop.index }}">40</label>

             <input type="radio" id="talle42_{{ loop.index }}" name="talle_{{ loop.index }}" value="42">
             <label for="talle42_{{ loop.index }}">42</label>
           </div>

          <button onclick="agregarAlCarrito('{{ producto.nombre }}', '{{ producto.precio }}','talle_{{ loop.index }}' )">Agregar al carrito
          </button>
        </div>
      {% endfor %}
    </div>
  </div>
</section>


{% endfor %}



<script>
  let carrito = [];

  // Cargar el carrito desde localStorage al abrir la p√°gina
  window.onload = function() {
    const guardado = localStorage.getItem("carrito");
    if (guardado) {
      carrito = JSON.parse(guardado);
      mostrarCarrito();
    }
  };

  function guardarCarrito() {
    localStorage.setItem("carrito", JSON.stringify(carrito));
  }

  function agregarAlCarrito(nombre, precio, grupoTalle){
    const talleSeleccionado = document.querySelector(`input[name="${grupoTalle}"]:checked`);
  
    if (!talleSeleccionado) {
      alert("Por favor seleccion√° un talle üòÖ");
      return;
    }
    
    carrito.push({ nombre, precio,talle: talleSeleccionado.value  });
    guardarCarrito();
    mostrarCarrito();
  }

  function mostrarCarrito() {
    const lista = document.getElementById("lista-carrito");
    if (!lista) return; // por si una p√°gina no tiene carrito visible
    lista.innerHTML = "";

    carrito.forEach((item, index) => {
      const li = document.createElement("li");
      li.textContent = `${item.nombre} - ${item.precio} - Talle: ${item.talle}`;

      const btnEliminar = document.createElement("button");
      btnEliminar.textContent = "‚ùå";
      btnEliminar.style.border = "none";
      btnEliminar.style.background = "transparent";
      btnEliminar.style.cursor = "pointer";
      btnEliminar.onclick = () => eliminarDelCarrito(index);

      li.appendChild(btnEliminar);
      lista.appendChild(li);
    });
  }

  function eliminarDelCarrito(index) {
    carrito.splice(index, 1);
    guardarCarrito();
    mostrarCarrito();
  }

  function realizarCompra() {
    if (carrito.length === 0) {
      alert("Tu carrito est√° vac√≠o üòÖ");
      return;
    }

    let mensaje = "Hola! Quisiera comprar los siguientes productos:%0A%0A";
    carrito.forEach((item, i) => {
      mensaje += `${1}. ${item.nombre} - ${item.precio}%0A - ${item.talle} .`;
    });

    const telefono = "5491122334455"; // Cambi√° por el n√∫mero del vendedor
    const url = `https://wa.me/${telefono}?text=${mensaje}`;
    window.open(url, "_blank");
  }
</script>
{% endblock %}
