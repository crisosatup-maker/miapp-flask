{% extends 'index.html' %}

{% block content %}
  <h2 id="medias">Medias</h2>

<div class="mini-menu-flotante">
  <h6>Modelos de Medias: <h6>
  <ul>
    <li><a href="#medias">Inicio</a></li>
    {% for modelo in modelos %}
      <li><a href="#modelo-{{ loop.index }}">{{ modelo.nombretitulo }}</a></li>
    {% endfor %}
  </ul>
</div>

{% for modelo in modelos %}
 <section class="categoria" id="modelo-{{ loop.index }}">
    <div class="modelo-descripcion">
        <h3>{{ modelo.nombretitulo }}</h3>
        <p>{{ modelo.descripcion }}</p>
        <p><strong>{{ modelo.talles }}</strong></p>
      </div>

    <div class="modelo-fotos">
      {% for producto in modelo.productos %}
        <div class="producto">
          <img src="{{ url_for('static', filename=producto.imagen) }}" alt="{{ producto.nombre }}">
          <p>{{ producto.nombre }}</p>
          <p>{{ producto.precio }}</p>
          

          <button onclick="agregarAlCarrito('{{ producto.nombre }}', '{{ producto.precio }}')">Agregar al carrito
          </button>
        </div>
      {% endfor %}
    </div>
  </div>
</section>
{% endfor %}

<div id="modal-imagen" class="modal">
  <span class="cerrar">&times;</span>
  <img class="modal-contenido" id="imagen-grande">
</div>

<script>
  // Obtiene elementos
  const modal = document.getElementById("modal-imagen");
  const imgGrande = document.getElementById("imagen-grande");
  const cerrar = document.querySelector(".cerrar");

  // Para todas las im√°genes de modelo
  document.querySelectorAll(".modelo-fotos img").forEach(img => {
    img.addEventListener("click", () => {
      modal.style.display = "flex";
      imgGrande.src = img.src;
    });
  });

  // Cierra al hacer clic en la cruz
  cerrar.addEventListener("click", () => {
    modal.style.display = "none";
  });

  // Tambi√©n cierra al hacer clic fuera de la imagen
  modal.addEventListener("click", (e) => {
    if (e.target === modal) {
      modal.style.display = "none";
    }
  });
</script>



<script>
  let carrito = []; 

  // Cargar el carrito desde localStorage al abrir la p√°gina
  window.onload = function() {
    const guardado = localStorage.getItem("carrito");
    if (guardado) {
      carrito = JSON.parse(guardado);
      mostrarCarrito();
    }
  };

  function guardarCarrito() {
    localStorage.setItem("carrito", JSON.stringify(carrito));
  }

  function agregarAlCarrito(nombre, precio) {
    
    
    carrito.push({ nombre, precio });
    guardarCarrito();
    mostrarCarrito();
  }

  function mostrarCarrito() {
    const lista = document.getElementById("lista-carrito");
    if (!lista) return; // por si una p√°gina no tiene carrito visible
    lista.innerHTML = "";

    carrito.forEach((item, index) => {
      const li = document.createElement("li");
      li.textContent = `${item.nombre} - ${item.precio} `;

      const btnEliminar = document.createElement("button");
      btnEliminar.textContent = "‚ùå";
      btnEliminar.style.border = "none";
      btnEliminar.style.background = "transparent";
      btnEliminar.style.cursor = "pointer";
      btnEliminar.onclick = () => eliminarDelCarrito(index);

      li.appendChild(btnEliminar);
      lista.appendChild(li);
    });
  }

  function eliminarDelCarrito(index) {
    carrito.splice(index, 1);
    guardarCarrito();
    mostrarCarrito();
  }

  function realizarCompra() {
    if (carrito.length === 0) {
      alert("Tu carrito est√° vac√≠o üòÖ");
      return;
    }

    let mensaje = "Hola! Quisiera comprar los siguientes productos:%0A%0A";
    carrito.forEach((item, i) => {
      mensaje += `${i + 1}. ${item.nombre} - ${item.precio}%0A`;
    });

    const telefono = "5492644691233"; // Cambi√° por el n√∫mero del vendedor
    const url = `https://wa.me/${telefono}?text=${mensaje}`;
    window.open(url, "_blank");
  }
</script>
{% endblock %}
